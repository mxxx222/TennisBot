version: '3.8'

services:
  betfury-system:
    build: .
    container_name: betfury-ultimate
    restart: unless-stopped
    
    environment:
      # Telegram (from .env)
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      
      # OpenAI
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      
      # API Football
      - API_FOOTBALL_KEY=${API_FOOTBALL_KEY}
      
      # System settings
      - MIN_CONFIDENCE=0.75
      - MIN_ODDS=1.10
      - MAX_ODDS=2.00
      - MAX_SIGNALS_PER_DAY=15
      - EDUCATIONAL_MODE=true
      
      # Mode
      - SYSTEM_MODE=balanced
    
    volumes:
      # Persist logs
      - ./logs:/app/logs
      
      # Persist data
      - ./data:/app/data
      
      # Config
      - ./config:/app/config
    
    # Resource limits (prevents runaway)
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # Network
    networks:
      - betfury-net
    
    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 5m
      timeout: 10s
      retries: 3
      start_period: 60s

  # Optional: Add monitoring with a simple web server
  monitoring:
    image: nginx:alpine
    container_name: betfury-monitoring
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./monitoring/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./logs:/var/log/nginx:ro
    networks:
      - betfury-net
    depends_on:
      - betfury-system
    profiles:
      - monitoring

networks:
  betfury-net:
    driver: bridge

volumes:
  betfury_logs:
  betfury_data: